# Понятие сборки сайта

Большинство современных сайтов построены на основе шаблонов, что позволяет использовать отдельные блоки многократно, снижая количество запросов на сервер, а также сделать структуру сайта по-настоящему динамической.

Принимая решение логически разбить сайт на множество взаимозависимых сущностей, разработчик получает инструментарий для ювелирной работы с веб-страницами. При этом становится актуальным понятие сборки сайта – согласования всех взаимосвязей и приведения кода к наиболее компактному виду.

Существует множество систем автоматической сборки и запуска задач, самые известные из которых:

* [Gulp](http://gulpjs.com/)
* [Grunt](http://gruntjs.com/)
* [Brunch](http://brunch.io/)
* [Broccoli](https://www.npmjs.org/package/broccoli)

При сборке сайта, созданного в предметной области [БЭМ](http://ru.bem.info/method/definitions/), возникает ряд специфических задач, с полным спектром которых справляются алгоритмы модулей [bem-tools](http://ru.bem.info/tools/bem/bem-tools/) и [enb](http://enb-make.info/). 

Параметры сборки БЭМ-проекта могут быть определены различным образом, в зависимости от целей. К примеру, на основе одного и того же набора блоков легко получить две функционально разные версии сайта: стандартную и для мобильных устройств. Путём подключения тех или иных доступных функциональностей обеспечивается вариативность и гибкость настройки.

# Общая схема сборки БЭМ-проекта

**На входе:** имеем структуру, которая наглядна для разработчика, – библиотеки БЭМ и декларации страниц каждого бандла в [JSON](http://www.json.org/).

**В процессе:** учитываем все зависимости сущностей, отбрасываем всё лишнее.

**На выходе:** получаем скомпилированный и оптимизированный набор файлов, идеальный для передачи на обработку браузеру.

![Общая схема сборки](http://cs616029.vk.me/v616029206/18e8b/axuWcHUa8hk.jpg)

# Сборка на практике

Перед тем как собрать проект, убедимся, что у нас имеются файлы конфигурации сборки:

*	**bower.json** - *декларация используемых библиотек*

* **.bem/techs/make.js** - *декларация всех используемых технологий и уровней библиотек*

Разработчик может выбрать, какие технологии и какие уровни библиотек подключать, на основании чего впоследствии будет составлен документ с зависимостями сущностей.

Отметим, что перед первой сборкой в каждом бандле хранится лишь один файл – *<имя_бандла>.bemjson.js*. Это описание всех блоков, элементов и модификаторов, используемых для реализации данного бандла, в формате JSON.

Определимся, какую команду использовать для сборки:

* `$ bem make` при запуске пересобирает проект полностью, сохраняет локальную копию

* `$ bem server` при запуске обрабатывает только изменённые файлы, позволяет просмотреть итоговый проект в браузере, на TCP 8080

Сразу после применения команды начинается первый этап сборки: на основе стандартной JavaScript-декларации бандла создаётся файл декларации в БЭМ-формате. При этом, за счёт устранения повторяющихся отрезков кода уменьшается его итоговый объём, а сам файл **.bemdecl.js* в оптимальной форме перечисляет используемые блоки, элементы и модификаторы и технологии, в которых каждый из них реализован. 

На втором этапе создаётся файл **.deps.js*, который представляет собой упорядоченный массив, описывающий зависимость сущностей бандла от других сущностей и от технологий.

Финальный этап – генерация отдельных файлов для технологий, каждый из которых представляет собой совокупность всех правил, касающихся сущностей данного бандла, в рамках конкретной технологии. В процессе генерации импорт файлов в CSS и включения в JS последовательно раскрываются с помощью [borschik](http://ru.bem.info/tools/optimizers/borschik/).

Описанный процесс происходит автоматически, после его завершения в папках бандлов появляется главный результат сборки – оптимизированные файлы технологий, которые являются отличительной чертой БЭМ-проектов. С помощью одной команды из множества разрозненных блоков собираются цельные конструкции оптимизированных данных, которые обрабатываются браузером максимально быстро.
